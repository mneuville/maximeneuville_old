(function($) {
    'use strict';

    $.Common = function() {
    	//  Settings
    	this.settings = {
    		offset: 90,
			duration: 500,
			effect: 'slide',
			options: { direction: 'left' },
			nb_project: 10,
			current_project: null
    	};

    	// Elements
        this.elements = {
            win: $(window),
            html_body: $('html, body'),
            menu: $('nav'),
            menu_item: $('li > a', 'nav'),
            back_top: $('#back-top'),
            wrapper: $('body > .wrapper'),
            detail: $('#detail'),
            projects: $('#projects'),
            project_link: $('figure figcaption a', '#projects'),
            project_close: $('a.close', '#detail'),
            project_next: $('a.next', '#detail'),
            project_previous: $('a.previous', '#detail'),
            project_container: $('.block-content', '#detail'),
            project_pagination: $('a.next, a.previous', '#detail'),
            secret: $('#secret')
        };

        // Init
        this.init();
    };

    $.Common.prototype = {
        init: function() {
            var self = this;
            self.bindEvents();
            self.menu();
            self.backToTop();
        },
        bindEvents: function() {
        	var self = this;
			self.elements.project_link.click(function(event) {
				event.preventDefault();
				var content = $(this).next('.container');
				content.clone().appendTo(self.elements.project_container);
				self.toggleProject($(this));
			});
			self.elements.project_close.click(function(event) {
				event.preventDefault();
				self.toggleProject($(this), true);
			});
			self.elements.project_pagination.on('click', {self: self}, self.changeProject);
        },
        toggleProject: function(object, close) {
        	var self = this;
        	this.elements.detail.toggle(self.settings.effect, self.settings.options, self.settings.duration, function() {
        		if (close === true) {
        			self.elements.project_container.html('');
        		} else {
        			self.settings.current_project = object.parents('figure').data('id');
        			self.updatePagination();
        		}
			});
        },
        changeProject: function(event) {
        	var self    = event.data.self;
        	var new_id  = ($(this).hasClass('next')) ? self.settings.current_project+1 : self.settings.current_project-1;
        	if (new_id >= 1 && new_id <= self.settings.nb_project) {
        		self.updateProject(new_id);
        	}
        },
        updateProject: function(id) {
        	this.elements.project_container.html('');
        	var project = this.elements.projects.find("figure[data-id='"+id+"']");
    		var content = project.find('.container');
			content.clone().appendTo(this.elements.project_container);
			this.settings.current_project = id;
			this.updatePagination();
        },
        updatePagination: function() {
        	this.elements.project_next.attr('title', this.elements.project_next.data('title'));
        	this.elements.project_previous.attr('title', this.elements.project_previous.data('title'));
        	this.elements.project_pagination.removeClass('disable');

        	if (this.settings.current_project == 1) {
				this.elements.project_previous.addClass('disable');
				this.elements.project_previous.removeAttr('title');
			}
			if (this.settings.current_project == 10) {
				this.elements.project_next.addClass('disable');
				this.elements.project_next.removeAttr('title');
			}
        },
        menu: function() {
        	var self = this;
			self.elements.menu_item.click(function(event) {
				event.preventDefault();
				var link = $(this).attr("href");
				self.elements.html_body.animate({
					scrollTop: $(link).offset().top
				}, 'slow');
			});
        },
        backToTop: function() {
			var self = this;
        	// Back to top
			self.elements.back_top.click(function(event) {
				event.preventDefault();
				self.elements.html_body.animate({scrollTop: 0}, self.settings.duration);
			});
			// Show button (scroll)
			self.elements.win.scroll(function() {
				if ($(this).scrollTop() >= self.settings.offset) {
					self.elements.back_top.fadeIn(self.settings.duration);
				} else {
					self.elements.back_top.fadeOut(self.settings.duration);
				}
			});
        }
    };

    $(document).ready(function() {
        new $.Common();
    });
})(jQuery);